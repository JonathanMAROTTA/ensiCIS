terraform_destroy:
  stage: destroy
  image: gitlab.ensimag.fr:5050/marottaj/3a_projet_cis:latest
  script:
    - echo "Configuring Kube config"
    - aws eks update-kubeconfig --region "us-east-1" --name "eks-simple"

    - echo "Destroying the cluster resources"
    - cd ansible
    - ansible-playbook -i inventory.ini teardown.yml
    - cd ..

    - echo "Destroying the terraform resources"
    - cd terraform
    - terraform init
    - terraform destroy -auto-approve
    - cd ..

  when: manual
